<?xml version="1.0" encoding="UTF-8" standalone="no"?><SQLQuery AllowBuffering="false" AllowFuture="true" AllowNullValues="false" AutoCommit="True" AutoTypeParameters="false" CacheDuration="0" CacheDurationUnits="M" Columns="" Comment="" Connector="" DateColumn="" DateFormat="MM/dd/yyyy HH:mm:ss" Debug="false" Description="" DocType="SQLQuery" Duration="60" DurationUnits="M" EndDate="" FilterExpr="" FixedQuery="" GroupingExpr="" HanaDataSource="False" ID="759" InlineTransform="" IntervalCount="1" IsCachable="false" JoinExpr="" Mask="" Method="" Mode="Command" NumberFormat="0.00" Param.1="" Param.10="" Param.11="" Param.12="" Param.13="" Param.14="" Param.15="" Param.16="" Param.17="" Param.18="" Param.19="" Param.2="" Param.20="" Param.21="" Param.22="" Param.23="" Param.24="" Param.25="" Param.26="" Param.27="" Param.28="" Param.29="" Param.3="" Param.30="" Param.31="" Param.32="" Param.4="" Param.5="" Param.6="" Param.7="" Param.8="" Param.9="" ParamDescription.1="" ParamDescription.10="" ParamDescription.11="" ParamDescription.12="" ParamDescription.13="" ParamDescription.14="" ParamDescription.15="" ParamDescription.16="" ParamDescription.17="" ParamDescription.18="" ParamDescription.19="" ParamDescription.2="" ParamDescription.20="" ParamDescription.21="" ParamDescription.22="" ParamDescription.23="" ParamDescription.24="" ParamDescription.25="" ParamDescription.26="" ParamDescription.27="" ParamDescription.28="" ParamDescription.29="" ParamDescription.3="" ParamDescription.30="" ParamDescription.31="" ParamDescription.32="" ParamDescription.4="" ParamDescription.5="" ParamDescription.6="" ParamDescription.7="" ParamDescription.8="" ParamDescription.9="" ParamType.1="" ParamType.10="" ParamType.11="" ParamType.12="" ParamType.13="" ParamType.14="" ParamType.15="" ParamType.16="" ParamType.17="" ParamType.18="" ParamType.19="" ParamType.2="" ParamType.20="" ParamType.21="" ParamType.22="" ParamType.23="" ParamType.24="" ParamType.25="" ParamType.26="" ParamType.27="" ParamType.28="" ParamType.29="" ParamType.3="" ParamType.30="" ParamType.31="" ParamType.32="" ParamType.4="" ParamType.5="" ParamType.6="" ParamType.7="" ParamType.8="" ParamType.9="" Password="" PathID="279" Query="set NOCOUNT on&#10;declare @planned int,&#10;@plannedTime int,&#10;@reason nvarchar(200), &#10;@unplannedCode int ,&#10;@planneddiff int,&#10;@unplanneddiff int,&#10;@StartTime datetime,&#10;@plannedTimeHist int,&#10;@unplannedTimeHist int&#10;&#10;SELECT &#10;@planned=PLANNED, &#10;@plannedTime=[PLANNED_TIME], &#10;@reason = [DESCRIPTION]&#10;FROM EST.dbo.[CNFG_DOWNTIME_REASON]&#10;where [ID]=[Param.3]&#10;&#10;SELECT @StartTime= START_TIME,&#10;@plannedTimeHist=isnull(PLANNED_TIME,0) ,&#10;@unplannedTimeHist= isnull(UNPLANNED_TIME,0)&#10;FROM EST.dbo.LIVE_NETWORK&#10;WHERE &#10;[GUID]='[Param.4]'&#10;&#10;set @planneddiff=0, @unplanneddiff=0&#10;&#10;if ((@planned=1 and  @plannedTime&gt;= datediff(minute,'[Param.1]','[Param.2]' )) or @planned=0 )&#10;BEGIN&#10;INSERT INTO EST.dbo.[LIVE_DOWNTIME](&#10;   &#10;   [START_TIME]&#10;  ,[END_TIME]&#10;  ,[REASON_ID]&#10;  ,PLANNED&#10;  ,[GUID]&#10;) VALUES (&#10;   &#10;   '[Param.1]' -- START_TIME - IN datetime&#10;  ,'[Param.2]' -- END_TIME - IN datetime&#10;  ,'[Param.3]' -- REASON_ID - IN int&#10;  ,@planned -- PLANNED - IN int&#10;  ,'[Param.4]' -- GUID - IN nvarchar(600)&#10;)&#10;&#10;if (@planned=1)&#10;set @planneddiff=datediff(minute,'[Param.1]','[Param.2]' )&#10;else &#10;set @unplanneddiff=datediff(minute,'[Param.1]','[Param.2]' )&#10;&#10;UPDATE EST.dbo.LIVE_NETWORK&#10;SET   &#10;UPTIME=datediff(minute,@StartTime,getdate())-(@plannedTimeHist+@unplannedTimeHist+@planneddiff+ @unplanneddiff),  &#10;PLANNED_TIME=@plannedTimeHist+@planneddiff, &#10;UNPLANNED_TIME=@unplannedTimeHist+@unplanneddiff&#10;WHERE &#10;[GUID]='[Param.4]'&#10;&#10;END&#10;ELSE &#10;BEGIN&#10;&#10;SELECT @unplannedCode= [ID] FROM  [CNFG_DOWNTIME_REASON]&#10;WHERE [DESCRIPTION]=@reason &#10;and PLANNED=0&#10;&#10;INSERT INTO EST.dbo.[LIVE_DOWNTIME](&#10;   &#10;   [START_TIME]&#10;  ,[END_TIME]&#10;  ,[REASON_ID]&#10;  ,PLANNED&#10;  ,[GUID]&#10;) VALUES (&#10;   &#10;   '[Param.1]' -- START_TIME - IN datetime&#10;  , dateadd(mi, @plannedTime,'[Param.1]') -- END_TIME - IN datetime&#10;  ,'[Param.3]' -- REASON_ID - IN int&#10;  ,@planned -- PLANNED - IN int&#10;  ,'[Param.4]' -- GUID - IN nvarchar(600)&#10;)&#10;&#10;INSERT INTO EST.dbo.[LIVE_DOWNTIME](&#10;   &#10;   [START_TIME]&#10;  ,[END_TIME]&#10;  ,[REASON_ID]&#10;  ,PLANNED&#10;  ,[GUID]&#10;) VALUES (&#10;   &#10;   dateadd(mi, @plannedTime,'[Param.1]') -- START_TIME - IN datetime&#10;  ,'[Param.2]' -- END_TIME - IN datetime&#10;  ,@unplannedCode -- REASON_ID - IN int&#10;  ,0 -- PLANNED - IN int&#10;  ,'[Param.4]' -- GUID - IN nvarchar(600)&#10;)&#10;&#10;&#10;set @unplanneddiff=datediff(minute,dateadd(mi, @plannedTime,'[Param.1]'),'[Param.2]' )&#10;, @planneddiff=@plannedTime&#10;&#10;UPDATE EST.dbo.LIVE_NETWORK&#10;SET   &#10;UPTIME=datediff(minute,@StartTime,getdate())-(@plannedTimeHist+@unplannedTimeHist+@planneddiff+ @unplanneddiff), &#10;PLANNED_TIME=@plannedTimeHist+@planneddiff, &#10;UNPLANNED_TIME=@unplannedTimeHist+@unplanneddiff&#10;WHERE &#10;[GUID]='[Param.4]'&#10;END " QueryParams="" ReaderRoles="SAP_XMII_User" RestrictedPropertyOverride="false" ResultSetMode="false" RowCount="100" SaveDate="08/29/2023 12:55:11" Schedule="" SelectedColumns="" Server="MII_DB" Service="" SetMaxRows="true" SortExpr="" StartDate="" Tables="" Time="" TimePeriod="" Trace="false" TransformerLibrary="" UseTypedParams="false" UserName="" Version="15.5.0.14" WriterRoles="SAP_XMII_Super_Administrator,SAP_XMII_Administrator,SAP_XMII_Developer" XParamName.1="" XParamName.10="" XParamName.11="" XParamName.12="" XParamName.13="" XParamName.14="" XParamName.15="" XParamName.16="" XParamName.2="" XParamName.3="" XParamName.4="" XParamName.5="" XParamName.6="" XParamName.7="" XParamName.8="" XParamName.9="" XParamValue.1="" XParamValue.10="" XParamValue.11="" XParamValue.12="" XParamValue.13="" XParamValue.14="" XParamValue.15="" XParamValue.16="" XParamValue.2="" XParamValue.3="" XParamValue.4="" XParamValue.5="" XParamValue.6="" XParamValue.7="" XParamValue.8="" XParamValue.9="" XmlDateFormat="yyyy-MM-dd'T'HH:mm:ss" XmlNumberFormat=""><Tasks/><ETCServers/><ETCObjects/></SQLQuery>